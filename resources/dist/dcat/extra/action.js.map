{"version":3,"file":"/resources/dist/dcat/extra/action.js","mappings":"6sBAAA,SAAWA,GAAM,IAEPC,EAAM,WAoBP,O,EAnBD,SAAAA,EAAYC,I,4FAASC,CAAA,KAAAF,GACjBG,KAAKF,QAAUG,EAAEC,OAAO,CACpBC,SAAU,KACVC,MAAO,QACPC,OAAQ,OACRC,IAAK,KACLC,IAAK,KACLC,KAAM,CAAC,EACPC,QAAS,KACTC,YAAa,KACbC,OAAQ,SAAUH,EAAMI,GAAS,EACjCC,KAAM,SAAUD,EAAQC,EAAML,GAC1BI,EAAOC,KAAKA,EAChB,EACAC,QAAS,SAAUF,EAAQG,GAAU,EACrCC,MAAO,SAAUJ,EAAQG,GAAU,GACpCjB,GAEHE,KAAKiB,MACT,G,EAAC,EAAAX,IAAA,OAAAY,MAED,WACI,IAAIC,EAAQnB,KAAMF,EAAUqB,EAAMrB,QAElCG,EAAEH,EAAQK,UAAUiB,IAAItB,EAAQM,OAAOiB,GAAGvB,EAAQM,OAAO,SAAUkB,GAC/D,IAAId,EAAOP,EAAED,MAAMQ,OACfI,EAASX,EAAED,MACf,KAAIY,EAAOW,KAAK,WAAa,KAIe,IAAxCzB,EAAQa,OAAOH,EAAMI,EAAQO,GAAjC,CAaA,IAAIK,EAAU1B,EAAQW,QAElBe,EACA5B,EAAKa,QAAQe,EAAQ,GAAIA,EAAQ,GAAIC,GAErCA,GAhBJ,CAGA,SAASA,IACLb,EAAOW,KAAK,UAAW,GAEvBG,OAAOC,OAAOnB,EAAMV,EAAQU,MAE5BW,EAAMS,QAAQhB,EAAQJ,GAAMqB,KAAKV,EAAMW,WAAU,MAAOX,EAAMY,SAClE,CASJ,GACJ,GAAC,CAAAzB,IAAA,UAAAY,MAED,WACI,IAAkBpB,EAANE,KAAsBF,QAElC,OAAO,SAAUkC,GACb,IAAIC,EAAWD,EAAO,GAClBpB,EAAWoB,EAAO,IAEoB,IAAtClC,EAAQgB,QAAQF,EAAQqB,IAI5BrC,EAAKsC,mBAAmBD,EAAU,CAACpB,KAAMf,EAAQe,KAAMD,OAAQA,GACnE,CACJ,GAAC,CAAAN,IAAA,SAAAY,MAED,WACI,IAAIpB,EAAUE,KAAKF,QAEnB,OAAO,SAAUkC,GACb,IAAIP,EAAUO,EAAO,GAAIpB,EAASoB,EAAO,IAEA,IAArClC,EAAQgB,QAAQF,EAAQa,KAIxBA,GAA2C,WAAhCU,EAAOV,EAAQW,eAC1BxC,EAAKoB,MAAMS,EAAQW,aAAaC,SAEpCC,QAAQtB,MAAMgB,GAClB,CACJ,GAAC,CAAA1B,IAAA,UAAAY,MAED,SAAQN,EAAQJ,GACZ,IAAIV,EAAUE,KAAKF,QAEnB,OAAO,IAAIyC,SAAQ,SAAUT,EAASC,GAClCL,OAAOC,OAAOnB,EAAM,CAChBgC,QAAS1C,EAAQY,YACjB+B,KAAM3C,EAAQQ,IACdoC,OAAQ9C,EAAK+C,QAGjB/C,EAAKgD,GAAGC,QAER5C,EAAE6C,KAAK,CACHzC,OAAQP,EAAQO,OAChBE,IAAKT,EAAQS,IACbC,KAAMA,EACNM,QAAS,SAAUN,GACfI,EAAOW,KAAK,UAAW,GACvB3B,EAAKgD,GAAGG,OACRjB,EAAQ,CAACtB,EAAMI,GACnB,EACAI,MAAM,SAASS,GACXb,EAAOW,KAAK,UAAW,GACvB3B,EAAKgD,GAAGG,OACRhB,EAAO,CAACN,EAASb,GACrB,GAER,GACJ,M,yFAAC,CAnHO,GAsHZhB,EAAKC,OAAS,SAAUmD,GACpB,OAAO,IAAInD,EAAOmD,EACtB,CACH,CA3HD,CA2HGpD,K","sources":["webpack:///./resources/assets/dcat/extra/action.js"],"sourcesContent":["(function (Dcat) {\r\n\r\n    class Action {\r\n        constructor(options) {\r\n            this.options = $.extend({\r\n                selector: null, // 按钮选择器\r\n                event: 'click',\r\n                method: 'POST',\r\n                key: null, // 行主键\r\n                url: null,\r\n                data: {}, // 发送到接口的附加参数\r\n                confirm: null,\r\n                calledClass: null,\r\n                before: function (data, target) {}, // 发起请求之前回调，返回false可以中断请求\r\n                html: function (target, html, data) { // 处理返回的HTML代码\r\n                    target.html(html);\r\n                },\r\n                success: function (target, results) {}, // 请求成功回调，返回false可以中断默认的成功处理逻辑\r\n                error: function (target, results) {}, // 请求出错回调，返回false可以中断默认的错误处理逻辑\r\n            }, options);\r\n\r\n            this.init();\r\n        }\r\n\r\n        init() {\r\n            let _this = this, options = _this.options;\r\n\r\n            $(options.selector).off(options.event).on(options.event, function (e) {\r\n                let data = $(this).data(),\r\n                    target = $(this);\r\n                if (target.attr('loading') > 0) {\r\n                    return;\r\n                }\r\n\r\n                if (options.before(data, target, _this) === false) {\r\n                    return;\r\n                }\r\n\r\n                // 发起请求\r\n                function request() {\r\n                    target.attr('loading', 1);\r\n\r\n                    Object.assign(data, options.data);\r\n\r\n                    _this.promise(target, data).then(_this.resolve()).catch(_this.reject());\r\n                }\r\n\r\n                var conform = options.confirm;\r\n\r\n                if (conform) {\r\n                    Dcat.confirm(conform[0], conform[1], request);\r\n                } else {\r\n                    request()\r\n                }\r\n            });\r\n        }\r\n\r\n        resolve() {\r\n            let _this = this, options = _this.options;\r\n\r\n            return function (result) {\r\n                var response = result[0],\r\n                    target   = result[1];\r\n\r\n                if (options.success(target, response) === false) {\r\n                    return;\r\n                }\r\n\r\n                Dcat.handleJsonResponse(response, {html: options.html, target: target});\r\n            };\r\n        }\r\n\r\n        reject() {\r\n            let options = this.options;\r\n\r\n            return function (result) {\r\n                var request = result[0], target = result[1];\r\n\r\n                if (options.success(target, request) === false) {\r\n                    return;\r\n                }\r\n\r\n                if (request && typeof request.responseJSON === 'object') {\r\n                    Dcat.error(request.responseJSON.message)\r\n                }\r\n                console.error(result);\r\n            }\r\n        }\r\n\r\n        promise(target, data) {\r\n            let options = this.options;\r\n\r\n            return new Promise(function (resolve, reject) {\r\n                Object.assign(data, {\r\n                    _action: options.calledClass,\r\n                    _key: options.key,\r\n                    _token: Dcat.token,\r\n                });\r\n\r\n                Dcat.NP.start();\r\n\r\n                $.ajax({\r\n                    method: options.method,\r\n                    url: options.url,\r\n                    data: data,\r\n                    success: function (data) {\r\n                        target.attr('loading', 0);\r\n                        Dcat.NP.done();\r\n                        resolve([data, target]);\r\n                    },\r\n                    error:function(request){\r\n                        target.attr('loading', 0);\r\n                        Dcat.NP.done();\r\n                        reject([request, target]);\r\n                    }\r\n                });\r\n            });\r\n        }\r\n    }\r\n\r\n    Dcat.Action = function (opts) {\r\n        return new Action(opts);\r\n    };\r\n})(Dcat);\r\n\r\n"],"names":["Dcat","Action","options","_classCallCheck","this","$","extend","selector","event","method","key","url","data","confirm","calledClass","before","target","html","success","results","error","init","value","_this","off","on","e","attr","conform","request","Object","assign","promise","then","resolve","reject","result","response","handleJsonResponse","_typeof","responseJSON","message","console","Promise","_action","_key","_token","token","NP","start","ajax","done","opts"],"sourceRoot":""}